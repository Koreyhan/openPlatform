!function(g,initFunc){"function"==typeof define&&(define.amd||define.cmd)?define(function(){return initFunc(g)}):initFunc(g,true)}(window,function(glob,needSetGlobal){var nav;var browserEnv;var bwAPI;var cfg={};var bwVer;var logEl;var apiNameMap={config:"config",requestPayment:"requestPayment",shareWechat:"shareWechat"};var configCB={_readyCBs:[]};var stateInfo={state:0,res:{}};nav=navigator.userAgent.toLowerCase();if(nav.match(/bitcvwallet\/ios/i)=="bitcvwallet/ios"){browserEnv="ios"}else{if(nav.match(/bitcvwallet\/android/i)=="bitcvwallet/android"){browserEnv="android"}else{browserEnv="other"}}wxVer=function(){var version=nav.match(/bitcvwallet\/(\d+\.\d+\.\d+)/)||nav.match(/bitcvwallet\/(\d+\.\d+)/);return version?version[1]:""}();bwAPI={config:function(parm){cfg=parm;setupWebViewJavascriptBridge(function(bridge){if(bridge.init){bridge.init(function(msg,resCb){})}invokeCmd(apiNameMap.config,parm,function(){configCB._complete=function(res){stateInfo.state=1};var cbArray=configCB._readyCBs;configCB.success=function(){for(var i=0,len=cbArray.length;i<len;i++){cbArray[i]()}configCB._readyCBs=[]};configCB.fail=function(res){configCB._fail?configCB._fail(res):configCB.state=-1};configCB.complete=function(){};return configCB}())})},ready:function(readyFunc){if(stateInfo.state!=0){sdkLog("ready");readyFunc()}else{configCB._readyCBs.push(readyFunc)}},error:function(errorFunc){if(stateInfo.state==-1){errorFunc(stateInfo.res)}else{configCB._fail=errorFunc}},requestPayment:function(parm){invokeCmd(apiNameMap.requestPayment,parm,parm)},shareWechat:function(parm){invokeCmd(apiNameMap.shareWechat,parm,parm)}};function setupWebViewJavascriptBridge(callback){if(browserEnv=="android"){if(window.WebViewJavascriptBridge){callback(window.WebViewJavascriptBridge)}else{document.addEventListener("WebViewJavascriptBridgeReady",function(){callback(window.WebViewJavascriptBridge)},false)}}else{if(browserEnv=="ios"){if(window.WebViewJavascriptBridge){return callback(WebViewJavascriptBridge)}if(window.WVJBCallbacks){return window.WVJBCallbacks.push(callback)}window.WVJBCallbacks=[callback];var WVJBIframe=document.createElement("iframe");WVJBIframe.style.display="none";WVJBIframe.src="https://__bridge_loaded__";document.documentElement.appendChild(WVJBIframe);setTimeout(function(){document.documentElement.removeChild(WVJBIframe)},0)}else{sdkLog("非app环境，无法使用SDK相关功能");console.warn("非app环境，无法使用SDK相关功能")}}}function invokeCmd(cmd,parm,callback){sdkLog("开始调用事件");if(window.WebViewJavascriptBridge){window.WebViewJavascriptBridge.callHandler(cmd,formatParm(parm),function(res){completeBridgeInteraction(cmd,res,callback)})}else{console.warn("调用失败，尚未完成Bridge初始化");sdkLog("调用失败，尚未完成Bridge初始化");completeBridgeInteraction(cmd,{errcode:1,errmsg:"SDK尚未 config 完成",data:{}},callback)}}function completeBridgeInteraction(cmd,res,callback){sdkLog("已经接收到回调");callback=callback||{};if(callback._complete){callback._complete(res);delete callback._complete}switch(res.errcode){case"0":case 0:callback.success&&callback.success(res);break;case"-1":case -1:callback.cancel&&callback.cancel(res);break;default:callback.fail&&callback.fail(res)}callback.complete&&callback.complete(res)}function sdkLog(text){if(cfg&&cfg.debug){if(logEl==undefined){logEl=document.createElement("p");logEl.setAttribute("id","bcvWalletLog");logEl.style.fontSize="20px";document.documentElement.appendChild(logEl)}var html=logEl.innerHTML+text+"----------";logEl.innerHTML=html}}function formatParm(parm){parm=parm||{};parm.config={appId:cfg.appId,signType:"sha1",timestamp:cfg.timestamp+"",nonceStr:cfg.nonceStr,signature:cfg.signature};sdkLog("调用数据："+JSON.stringify(parm));return parm}if(needSetGlobal){glob.bcvWallet=bwAPI}return bwAPI});